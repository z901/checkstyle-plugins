name: Pull upstream
on:
  #schedule:
  #  # * is a special character in YAML so you have to quote this string
  #  - cron:  '* * * * *'
  workflow_dispatch:
jobs:
  pull_upstream:
    runs-on: ubuntu-latest
    env:
      PREFIX: sync/main
      GH_TOKEN: ${{ secrets.WORKFLOW_TOKEN }}
    steps:
    - name: checkout
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.WORKFLOW_TOKEN }}
    - name: add upstream
      run: |
        gh pr list
        gh repo set-default ${{ github.server_url }}/${{ github.repository }}
        git remote add upstream https://github.com/kgyrtkirk/checkstyle-plugins
        git fetch upstream
        gh pr list
    - run: |
        REF=`git rev-parse upstream/main`
        .github/scripts/sync_open_pr --denoise main $REF "$PREFIX: $REF"
    - run: |
        .github/scripts/sync_cleanup "$PREFIX"
